<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:bal="http://wixtoolset.org/schemas/v4/wxs/bal">

  <?include _payload-vars.wxi ?>

  <Bundle
      Name="Local LLM Workbench Setup"
      Manufacturer="Local LLM Workbench"
      Version="0.1.0.0"
      UpgradeCode="5D54A200-90F4-4CF8-BD1C-95D0046A282C"
      DisableModify="yes"
      DisableRemove="yes">

    <BootstrapperApplication>
      <bal:WixStandardBootstrapperApplication
          Theme="rtfLargeLicense"
          LicenseFile="License.rtf"
          SuppressOptionsUI="no"
          SuppressRepair="yes"
          SuppressDowngradeFailure="yes"
          ShowVersion="yes" />
    </BootstrapperApplication>

    <Chain>

      <!-- Docker Desktop – download from internet -->
      <ExePackage
        Id="DockerDesktop"
        PerMachine="yes"
        InstallArguments="install --quiet --accept-license"
        UninstallArguments="uninstall --quiet"
        DetectCondition="DOCKERDESKTOPINSTALLED"
        Vital="no"
        Description="Docker Desktop">
          <ExePackagePayload
            Name="DockerDesktopInstaller.exe"
            DownloadUrl="$(var.DockerDownloadUrl)"
            Size="$(var.DockerSize)"
            Hash="$(var.DockerHash)" />
        </ExePackage>

      <!-- Visual C++ Redist – download from internet -->
      <ExePackage
        Id="VCRedist"
        PerMachine="yes"
        InstallArguments="/install /quiet /norestart"
        UninstallArguments="/uninstall /quiet /norestart"
        DetectCondition="VCRUNTIMEINSTALLED"
        Vital="yes"
        Description="Microsoft Visual C++ Redistributable">
        <ExePackagePayload
          Name="vc_redist.x64.exe"
          DownloadUrl="$(var.VCRedistDownloadUrl)"
          Size="$(var.VCRedistSize)"
          Hash="$(var.VCRedistHash)" />
      </ExePackage>

      <!-- Your MSI – always install -->
      <MsiPackage
          Id="WorkbenchMsi"
          SourceFile="..\..\app\release\Local LLM Workbench 0.1.0.msi"
          Vital="yes"
          Description="Local LLM Workbench" />

    </Chain>

    <!-- Launch app after successful installation -->
    <Variable Name="LaunchTargetPath" Value="[ProgramFilesFolder]Local LLM Workbench\Local LLM Workbench.exe" />

    <PayloadGroup Id="LaunchPayloadGroup" />
    
  </Bundle>
</Wix>